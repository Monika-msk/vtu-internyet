<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VTU Internship Watcher – Subscribe</title>
  <style>
    :root { --bg:#0b1020; --card:#121a33; --fg:#e7eefc; --muted:#a9b4cc; --brand:#4f7cff; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:linear-gradient(180deg, #0b1020, #0a0f1f 40%, #0a0f1f); color:var(--fg); }
    .wrap { max-width:780px; margin:40px auto; padding:0 16px; }
    .card { background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.3); }
    h1 { margin:0 0 8px; font-size:28px; }
    p { color:var(--muted); line-height:1.6; }
    .block { margin-top:20px; padding:16px; border-radius:12px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); }
    .label { font-weight:600; margin-bottom:6px; color:#c8d6ff; }
    a.btn { display:inline-block; background:var(--brand); color:white; text-decoration:none; padding:12px 16px; border-radius:10px; font-weight:600; box-shadow:0 6px 16px rgba(79,124,255,.35); }
    code, .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 90%; }
    ol { margin:8px 0 0 18px; }
    li { margin:6px 0; }
    .muted { color:var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Subscribe to Daily VTU Internship Alerts</h1>
      <p>Get a single email every day at <b>9:00 AM IST</b> with new internships posted on VTU Internyet. Your email will only be used for sending these alerts.</p>

      <div class="block">
        <div class="label">Subscribe</div>
        <form id="subscribeForm">
          <input type="email" id="email" name="email" placeholder="you@example.com" required style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0e1530;color:#e7eefc;outline:none" />
          <div style="display:flex;gap:8px;margin-top:12px">
            <button type="submit" class="btn">Subscribe</button>
            <span id="status" class="muted" aria-live="polite"></span>
          </div>
        </form>
      </div>

      <div class="block">
        <div class="label">How this works</div>
        <ol>
          <li>You submit your email using the form above.</li>
          <li>Your email is stored securely on our server.</li>
          <li>The system fetches the subscriber list and sends alerts every morning.</li>
          <li>You can unsubscribe anytime via the link in the email footer (coming soon).</li>
        </ol>
      </div>

      <div class="block">
        <div class="label">For Admins</div>
        <ol>
          <li>Deploy the backend (FastAPI) on Render (free): see <span class="mono">render.yaml</span>.</li>
          <li>Set GitHub secrets: <span class="mono">SENDER_EMAIL</span>, <span class="mono">SENDER_PASSWORD</span> (Gmail App Password).</li>
          <li>Set <span class="mono">SUBSCRIBERS_CSV_URL</span> to your backend's <span class="mono">/subscribers.csv</span> URL.</li>
          <li>Update the script tag below to point <span class="mono">BACKEND_BASE_URL</span> to your backend URL.</li>
        </ol>
        <p class="muted">GitHub Actions runs this job daily at 03:30 UTC (09:00 IST). See <span class="mono">.github/workflows/internship-watcher.yml</span>.</p>
      </div>

      <p class="muted">Made with ❤ for students. This site can be served via GitHub Pages (Settings → Pages → Branch: <span class="mono">main</span>, Folder: <span class="mono">/docs</span>).</p>
    </div>
  </div>

  <script>
    // Backend base URL (set this to your Render URL), e.g., "https://vtu-subs.onrender.com"
    const BACKEND_BASE_URL = "";
    const form = document.getElementById('subscribeForm');
    const statusEl = document.getElementById('status');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';
      const email = document.getElementById('email').value.trim();
      if (!BACKEND_BASE_URL) {
        statusEl.textContent = 'Subscription backend is not configured yet.';
        return;
      }
      try {
        const res = await fetch(`${BACKEND_BASE_URL}/subscribe`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await res.json();
        if (res.ok && data?.ok) {
          statusEl.textContent = data.message || 'Subscribed';
          form.reset();
        } else {
          statusEl.textContent = data?.detail || data?.message || 'Failed to subscribe';
        }
      } catch (err) {
        statusEl.textContent = 'Network error. Please try again later.';
      }
    });
  </script>
</body>
</html>
